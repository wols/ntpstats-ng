= Logstash
:linkattrs:
:toc:       macro

toc::[]

== Erste Schritte

Um die Verwendung von Logstash zu verstehen, soll als erstes Beispiel die Log-Datei `/var/log/ntp/ntp.log` überwacht und als Datei im JSON-Format abgespeichert werden.

== Konfiguration

=== ntpd

----
mkdir /var/log/ntp
chown ntp:ntp /var/log/ntp
----

.Gentoo, ntp-4.2.8p9
----
# /etc/conf.d/ntpd

NTPD_OPTS="-u ntp:ntp -l /var/log/ntp/ntp.log"
----

.CentOS 7, ntp-4.2.6p5
----
# /etc/sysconfig/ntpd
#
# see also /usr/lib/systemd/system/ntpd.service

OPTIONS="-g -l /var/log/ntp/ntp.log"
----

=== logstash

Die Logstash-Konfiguration teilt sich in die Abschnitte `input`, `filter` und
`output`.

Als `input`-Typ wird `ntplog` festgelegt.

Der Zeitstempel-Anteil des `output`-Dateinamens wird im xref:A-Bookmarks.adoc#bookmark_joda_time[Joda-Time-Format] angegeben.

.logstash-5.1.2
----
# /etc/logstash/conf.d/ntpstats-ng.conf

input {
    file {
        path => [ "/var/log/ntp/ntp.log" ]
        type => "ntplog"
    }
}

filter {}

output {
    if [type] == "ntplog" {
	file {
	    path => "/tmp/ntpstats-ng-%{+YYYYMMdd}.json"
	}
    }
}
----

== Es funktioniert!

Die Dienste `ntpd` und `logstash` sind gestoppt und die oben beschriebene Konfiguration ist gültig.

----
tail -F /var/log/messages /var/log/logstash/logstash-plain.log /var/log/ntp/ntp.log /tmp/ntpstats-ng-20170115.json
----

.Gentoo, openrc
----
/etc/init.d/logstash start

/etc/init.d/ntpd start
----

.CentOS 7, syslogd
----
systemctl start logstash.service

systemctl start ntpd.service
----

TIP: Wird fortgesetzt...

// End of ntpstats-ng/doc/de/doc/Logstash.adoc
